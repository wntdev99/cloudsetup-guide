# 🔄 Task Flow — CloudSetup.guide

> 최종 수정: 2025.02.07
> 버전: v1.0

---

## 1. 개요

이 문서는 사용자와 시스템의 주요 태스크를 플로우차트와 시퀀스 다이어그램으로 정의합니다.

**주요 태스크:**
| ID | 태스크 | Phase | 사용자 | 시스템 |
|----|--------|-------|--------|--------|
| TF01 | 가이드 탐색 및 접근 | 1 | ⭐ 핵심 | 라우팅, SSG |
| TF02 | 가이드 진행 (Step-by-Step) | 1 | ⭐ 핵심 | 콘텐츠 렌더링 |
| TF03 | 검색 | 1 | 자주 사용 | Pagefind |
| TF04 | 필터링 및 정렬 | 2 | 자주 사용 | 클라이언트 |
| TF05 | 무료 한도 확인 | 2 | 자주 사용 | 정적 데이터 |
| TF06 | 무료 한도 계산 | 2 | 가끔 사용 | 클라이언트 |
| TF07 | 피드백 제출 | 2 | 가끔 사용 | API → DB |
| TF08 | 회원가입/로그인 | 3 | 가끔 사용 | Supabase Auth |
| TF09 | 진행률 저장/복원 | 3 | 자동 | Supabase DB |
| TF10 | 댓글 작성 | 3 | 가끔 사용 | Supabase DB |
| TF11 | 언어 전환 | 1 | 가끔 사용 | 라우팅 |
| TF12 | 뉴스레터 구독 | 3 | 가끔 사용 | API → DB |

---

## 2. TF01: 가이드 탐색 및 접근

### 2.1 플로우차트

```
사용자 진입
    │
    ├─ [A] Google 검색으로 직접 진입
    │   └──→ 가이드 상세 페이지 (S05) ──→ TF02
    │
    ├─ [B] 홈페이지 (S01) 진입
    │   │
    │   ├─ 검색바 사용 ──→ TF03
    │   │
    │   ├─ 목적별 카드 클릭
    │   │   └──→ 해당 카테고리 가이드 목록 ──→ 가이드 선택 ──→ S05
    │   │
    │   ├─ 인기 가이드 클릭 ──→ S05
    │   │
    │   └─ 플랫폼 카드 클릭 ──→ 플랫폼 상세 (S03)
    │       └──→ API 목록에서 가이드 선택 ──→ S05
    │
    └─ [C] 다른 가이드에서 링크로 이동
        ├─ 선행 가이드 링크 ──→ S05
        ├─ 후행 가이드 추천 ──→ S05
        └─ 관련 가이드 링크 ──→ S05
```

### 2.2 시퀀스 다이어그램 (경로 A: Google 검색)

```
사용자          Google          Vercel CDN         브라우저
  │               │               │                  │
  │─ 검색 ───────→│               │                  │
  │               │               │                  │
  │←─ 결과 ───────│               │                  │
  │  (CloudSetup 링크)            │                  │
  │               │               │                  │
  │─ 클릭 ────────┼──────────────→│                  │
  │               │               │                  │
  │               │               │─ 정적 HTML ──────→│
  │               │               │  (SSG + CDN)     │
  │               │               │                  │
  │←──────────────┼───────────────┼── 가이드 렌더링 ──│
  │               │               │                  │
  │               │               │  JS 하이드레이션 ──│
  │               │               │  Pagefind 로드   ──│
  │               │               │  GA4 이벤트 전송  ──│
```

---

## 3. TF02: 가이드 진행 (★ 핵심 플로우)

### 3.1 전체 플로우차트

```
가이드 페이지 도달 (S05)
    │
    ▼
┌───────────────────┐
│ 선행 가이드 체크    │
│                   │
│ 모든 선행 가이드가  │──── 아니오 ──→ 선행 가이드 목록 표시
│ 완료/확인됐는가?   │                    │
└───────┬───────────┘               사용자가 "있어요" 또는
        │ 네                        가이드 링크 클릭
        ▼
┌───────────────────┐
│ Step 1 렌더링      │
│                   │
│ - 스크린샷 표시    │
│ - 설명 텍스트     │
│ - 코드블록 (있으면)│
│ - 콜아웃 (있으면)  │
└───────┬───────────┘
        │
        ▼
┌───────────────────┐
│ Checkpoint        │
│ "이 화면이 보이나요?"│
│                   │
│ [네] ──→ 진행률 업데이트 ──→ 다음 Step으로
│                   │
│ [안 됐어요] ──→ 트러블슈팅 표시
│                   │      │
│                   │      ├─ FAQ 확인
│                   │      ├─ 댓글에 질문 (Phase 3)
│                   │      └─ 해결됨 → 다음 Step으로
└───────────────────┘
        │
        ▼
    (Step 2, 3, ... N 반복)
        │
        ▼
┌───────────────────┐
│ 마지막 Step 완료   │
│                   │
│ 🎉 완료 화면      │
│                   │
│ - 결과 요약       │
│ - 무료 한도 확인   │
│ - 피드백 요청     │
│   [👍] [👎]       │
│                   │
│ - 다음 가이드 추천 │
│   [활용] [관련 API]│
│                   │
│ - 제휴 링크       │
└───────────────────┘
```

### 3.2 단계별 상세 플로우

```
Step N 진입
    │
    ▼
┌─ IntersectionObserver ─┐
│ 현재 단계 감지           │
│ → 진행률 바 업데이트     │
│ → 좌측 목차 하이라이트   │
│ → URL hash 업데이트     │
│   (#step-N)            │
└────────────────────────┘
    │
    ▼
┌─ 스크린샷 로딩 ──────────┐
│                          │
│ 이미지 로드 시:           │
│ 1. blur placeholder 표시 │
│ 2. 실제 이미지 로드       │
│ 3. 하이라이트 오버레이 적용│
│                          │
│ 모바일에서:               │
│ 탭 → 라이트박스 확대      │
└──────────────────────────┘
    │
    ▼
┌─ 사용자 인터랙션 ────────┐
│                          │
│ 코드 복사 버튼 클릭:      │
│ → clipboard.writeText()  │
│ → "복사됨 ✓" 토스트      │
│ → GA4 이벤트: code_copy  │
│                          │
│ DevTip 펼치기:            │
│ → 접힘 토글 (slide-down)  │
│                          │
│ 콜아웃 링크 클릭:         │
│ → 내부: 라우터 이동       │
│ → 외부: 새 탭에서 열기    │
└──────────────────────────┘
    │
    ▼
┌─ Checkpoint ─────────────┐
│                          │
│ "네" 클릭:                │
│ → completedSteps에 추가   │
│ → 진행률 바 업데이트      │
│ → 다음 단계로 스크롤      │
│ → (Phase 3) DB 저장      │
│                          │
│ "안 됐어요" 클릭:         │
│ → 트러블슈팅 모달 표시    │
│ → GA4 이벤트: guide_stuck│
│                          │
└──────────────────────────┘
```

### 3.3 진행률 저장 플로우 (Phase 3)

```
진행률 변경 발생
    │
    ├─ [비로그인 사용자]
    │   └─ localStorage에 저장
    │      key: "guide_progress_{slug}"
    │      value: { currentStep, completedSteps[], timestamp }
    │
    └─ [로그인 사용자]
        │
        ▼
    ┌─────────────────────────────┐
    │ Supabase UPSERT             │
    │                             │
    │ guide_progress 테이블        │
    │ ON CONFLICT (user_id, slug) │
    │ DO UPDATE SET               │
    │   current_step = N,         │
    │   completed = (N === total),│
    │   updated_at = now()        │
    └─────────────────────────────┘

가이드 재진입 시:
    │
    ├─ [비로그인] localStorage 확인
    │   └─ 있으면: "이전에 Step N까지 진행하셨어요. 이어서 하시겠어요?" 표시
    │
    └─ [로그인] Supabase SELECT
        └─ 있으면: 해당 Step으로 자동 스크롤 + 이전 단계 완료 표시
```

---

## 4. TF03: 검색

### 4.1 플로우차트

```
사용자가 검색바에 포커스
    │
    ▼
검색 모달/드롭다운 표시
    │
    ▼
타이핑 시작
    │
    ├─ 2글자 미만: 대기
    │
    └─ 2글자 이상:
        │
        ▼
    debounce 300ms
        │
        ▼
    Pagefind 검색 실행
        │
        ▼
    ┌─ 결과 있음 ─┐
    │             │
    │ 가이드 카드  │
    │ 목록 표시   │
    │             │
    │ 각 카드:    │
    │ - 제목      │
    │ - 플랫폼    │
    │ - 난이도    │
    │ - 무료한도  │
    │ - 매치 텍스트│
    │             │
    └─────────────┘
        │
        ▼
    사용자가 결과 클릭
        │
        ▼
    해당 가이드 페이지로 이동
    GA4 이벤트: search (query, selected_result)


    ┌─ 결과 없음 ─┐
    │             │
    │ "검색 결과가 │
    │  없습니다"  │
    │             │
    │ 추천:       │
    │ - 인기 가이드│
    │ - 다른 키워드│
    │             │
    └─────────────┘
```

---

## 5. TF04: 필터링 및 정렬

```
가이드 목록 페이지 (S04)
    │
    ▼
┌─ 필터 UI ──────────────────────────────────┐
│                                            │
│ 플랫폼: [전체] [GCP] [AWS] [Azure] [...]   │
│ 카테고리: [전체] [AI/ML] [컴퓨팅] [DB] [...] │
│ 난이도: [전체] [🟢초급] [🟡중급] [🔴고급]    │
│ 정렬: [인기순 ▾] [최신순] [소요시간순]       │
│                                            │
└─────────┬──────────────────────────────────┘
          │
          ▼
    URL 쿼리 파라미터 업데이트
    /guides?platform=gcp&category=ai-ml&difficulty=beginner&sort=popular
          │
          ▼
    getAllGuides()에서 필터 적용
    (빌드 시 모든 meta.json이 메모리에 로드됨)
          │
          ▼
    필터링된 가이드 카드 그리드 렌더링
          │
          ▼
    결과 수 표시: "GCP > AI/ML > 초급: 4개의 가이드"
          │
          ├─ 결과 있음: 카드 그리드 표시
          │
          └─ 결과 없음: "조건에 맞는 가이드가 없습니다. 필터를 조정해보세요."
```

---

## 6. TF06: 무료 한도 계산

```
사용자가 계산기 페이지 (S09) 접근
    │
    ▼
┌─ 카테고리 선택 ──────────────────┐
│ [☑ AI/ML] [☑ DB] [☐ 호스팅] ... │
└──────────┬───────────────────────┘
           │
           ▼ (선택한 카테고리에 맞는 입력 필드 표시)
┌─ 사용량 입력 ────────────────────┐
│                                  │
│ AI/ML API 호출: [___5,000___] 회/월│
│ DB 저장 용량:  [____500____] MB  │
│ DB 읽기:      [___50,000___] 회/월│
│ DB 쓰기:      [___10,000___] 회/월│
│                                  │
│ [🧮 계산하기]                     │
└──────────┬───────────────────────┘
           │
           ▼
    ┌─ 계산 로직 (클라이언트) ──────────────────────┐
    │                                              │
    │ for each freeTierEntry in free-tiers.json:   │
    │   if entry.category in selectedCategories:   │
    │     usagePercent = userInput / entry.amount   │
    │     if usagePercent <= 100%: ✅ 무료로 충분   │
    │     elif usagePercent <= 150%: ⚠️ 한도 근접   │
    │     else: ❌ 초과 → 대안 추천                 │
    │                                              │
    │ 최적 조합 추천:                                │
    │   = 모든 카테고리를 무료로 커버하는 플랫폼 조합  │
    │                                              │
    └──────────┬───────────────────────────────────┘
               │
               ▼
    ┌─ 결과 표시 ──────────────────────────────────┐
    │                                              │
    │ 🏆 추천 조합: GCP (AI API) + Supabase (DB)   │
    │ 예상 비용: $0                                │
    │                                              │
    │ 플랫폼별 상세:                                │
    │ - GCP Vision: 1000/5000 = 500% ❌ 초과       │
    │   → 대안: AWS Rekognition (5000회 무료)       │
    │ - AWS Rekognition: 5000/5000 = 100% ⚠️       │
    │ - Supabase DB: 500/500 = 100% ⚠️             │
    │   → 대안: Firebase Firestore (1GB 무료)       │
    │                                              │
    │ [이 조합으로 시작하기 →]                       │
    │  → GCP 계정 만들기 + Supabase 시작하기 링크   │
    │                                              │
    └──────────────────────────────────────────────┘
```

---

## 7. TF07: 피드백 제출

```
가이드 완료 (또는 하단 도달)
    │
    ▼
피드백 위젯 표시:
"이 가이드가 도움이 되었나요?"
    │
    ├─ [👍 도움됨] 클릭
    │   │
    │   ▼
    │   POST /api/feedback
    │   { guide_slug, helpful: true }
    │   │
    │   ▼
    │   "감사합니다! 😊" 표시
    │   GA4 이벤트: guide_feedback (helpful: true)
    │
    └─ [👎 어려웠어요] 클릭
        │
        ▼
    이유 선택 드롭다운 표시:
    [스크린샷이 달라요] [설명이 부족해요] [에러 발생] [기타]
        │
        ▼
    선택 후 (선택적) 상세 메시지 입력
    [__________________________]
        │
        ▼
    [제출]
        │
        ▼
    POST /api/feedback
    { guide_slug, helpful: false, issue_type, message }
        │
        ▼
    "소중한 피드백 감사합니다. 개선하겠습니다!"
    GA4 이벤트: guide_feedback (helpful: false, issue_type)
```

---

## 8. TF08: 회원가입/로그인 (Phase 3)

```
사용자가 로그인 필요 기능 접근
(진행률 저장, 댓글 작성 등)
    │
    ▼
로그인 모달 표시
    │
    ├─ [Google로 로그인]
    │   │
    │   ▼
    │   Supabase Auth: signInWithOAuth({ provider: 'google' })
    │   → Google OAuth 페이지 리다이렉트
    │   → 인증 완료
    │   → 콜백 URL로 리다이렉트
    │   → Supabase 세션 생성
    │   → profiles 테이블에 자동 INSERT (trigger)
    │   → 원래 페이지로 복귀
    │
    └─ [GitHub로 로그인]
        │
        ▼
        Supabase Auth: signInWithOAuth({ provider: 'github' })
        → (동일 흐름)

로그인 후:
    │
    ▼
┌─────────────────────────────────┐
│ 1. 세션 쿠키 설정               │
│ 2. localStorage 진행률 → DB 동기 │
│    (기존 로컬 데이터가 있으면)   │
│ 3. UI 업데이트:                  │
│    - 헤더에 아바타 표시          │
│    - 댓글 폼 활성화             │
│    - 진행률 바 DB 데이터 반영    │
└─────────────────────────────────┘
```

---

## 9. TF10: 댓글 작성 (Phase 3)

```
로그인 상태에서 가이드 페이지
    │
    ▼
댓글 섹션 스크롤 도달
    │
    ├─ 가이드 전체 댓글 탭
    │   └─ 기존 댓글 목록 로드 (Supabase SELECT)
    │
    └─ 특정 단계 댓글
        └─ step_number 필터로 로드
    │
    ▼
[댓글 작성 폼]
┌─────────────────────────────────┐
│ [아바타] 사용자이름              │
│                                 │
│ [이 단계에서 궁금한 점이 있나요?  │
│  ________________________________│
│  |                              |│
│  |______________________________|│
│                                 │
│ [게시]                           │
└─────────────────────────────────┘
    │
    ▼
유효성 검사:
    ├─ 빈 내용 → "내용을 입력해주세요" 에러
    ├─ 5000자 초과 → "5000자 이내로 작성해주세요" 에러
    └─ 통과 →
        │
        ▼
    Supabase INSERT INTO comments
    { user_id, guide_slug, step_number, content }
        │
        ▼
    낙관적 업데이트 (Optimistic UI):
    → 즉시 UI에 새 댓글 표시
    → 실패 시 롤백 + 에러 토스트

대댓글:
    기존 댓글의 [답변] 클릭
    → parent_id = 해당 댓글 ID
    → 동일 흐름 (들여쓰기 표시)
```

---

## 10. TF11: 언어 전환

```
사용자가 🌐 버튼 클릭
    │
    ▼
현재 URL: /ko/guides/gcp-vision-api-setup/
    │
    ▼
next-intl 라우터: locale 변경
    │
    ▼
새 URL: /en/guides/gcp-vision-api-setup/
    │
    ▼
┌─────────────────────────────────────┐
│ 1. UI 텍스트 전환 (messages/en.json) │
│ 2. MDX 본문 전환 (en.mdx 로드)      │
│ 3. 스크린샷 전환 (en 스크린샷)       │
│ 4. 메타 태그 전환 (seo.en)          │
│ 5. html lang 속성 변경              │
│ 6. 쿠키에 선호 언어 저장             │
│    (다음 방문 시 자동 적용)          │
└─────────────────────────────────────┘
```

---

## 11. 에러 처리 플로우

### 11.1 네트워크 에러

```
API 호출 실패 (피드백, 댓글, 진행률)
    │
    ▼
┌─ 재시도 로직 ──────────────────┐
│                                │
│ 1차 실패: 1초 후 자동 재시도    │
│ 2차 실패: 3초 후 자동 재시도    │
│ 3차 실패:                      │
│   → 토스트 알림:               │
│     "저장에 실패했습니다.       │
│      나중에 다시 시도해주세요." │
│   → 로컬 큐에 저장             │
│   → 다음 정상 요청 시 자동 재전송│
│                                │
└────────────────────────────────┘
```

### 11.2 404 에러

```
존재하지 않는 가이드 URL 접근
    │
    ▼
커스텀 404 페이지:
┌─────────────────────────────────┐
│                                 │
│  😅 이 가이드를 찾을 수 없어요.   │
│                                 │
│  혹시 이것을 찾으셨나요?          │
│  - [GCP Vision API 설정 가이드]  │
│  - [인기 가이드 목록]            │
│                                 │
│  🔍 [검색해보기]                 │
│                                 │
└─────────────────────────────────┘
```

---

## 12. 분석 이벤트 플로우

```
모든 페이지:
    page_view → GA4

가이드 페이지 진입:
    guide_start → GA4 { slug, platform, category, difficulty }

각 Step 도달:
    guide_step → GA4 { slug, step_number }

Checkpoint "네" 클릭:
    guide_step_complete → GA4 { slug, step_number }

Checkpoint "안 됐어요" 클릭:
    guide_stuck → GA4 { slug, step_number }

코드 복사:
    code_copy → GA4 { slug, step_number, code_type }

가이드 완료 (마지막 Step):
    guide_complete → GA4 { slug, platform, total_time }

피드백 제출:
    guide_feedback → GA4 { slug, helpful, issue_type }

검색:
    search → GA4 { query, results_count, selected_result }

필터 사용:
    filter_use → GA4 { filter_type, filter_value }

외부 링크 클릭 (제휴):
    outbound_click → GA4 { url, context }
```

---

*다음 문서: [api.md](./api.md) — API 설계*
