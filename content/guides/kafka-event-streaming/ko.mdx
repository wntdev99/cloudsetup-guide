# Kafka ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°í•˜ê¸°

Kafka í”„ë¡œë“€ì„œì™€ ì»¨ìŠˆë¨¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ê³  êµ¬ë…í•©ë‹ˆë‹¤. ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ê³  ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°„ í†µì‹ ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

<FreeTierInfo
  service="Apache Kafka"
  limit="ì˜¤í”ˆì†ŒìŠ¤, ë¬´ë£Œ ìì²´ í˜¸ìŠ¤íŒ…"
  period="one-time"
  status="free"
/>

## ì‹œì‘í•˜ê¸° ì „ì—

<PrerequisiteCheck items={[
  { text: "Kafka ì„¤ì¹˜ë¨", required: true },
  { text: "kafka-python ë˜ëŠ” kafkajs", required: true },
  { text: "í„°ë¯¸ë„", required: true },
  { text: "Python ë˜ëŠ” Node.js", required: true }
]} />

<Callout type="info">
ğŸ“Š **ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°ì´ë€?** ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ê³  ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ êµ¬ë…í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ëŠìŠ¨í•œ ê²°í•©(loosely coupled)ìœ¼ë¡œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</Callout>

---

<Step number={1} title="Python í”„ë¡œë“€ì„œ ì‘ì„±">

### ê¸°ë³¸ í”„ë¡œë“€ì„œ

ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ëŠ” í”„ë¡œë“€ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

<CopyBlock language="python" title="Python í”„ë¡œë“€ì„œ">
from kafka import KafkaProducer
import json
import time

producer = KafkaProducer(
  bootstrap_servers='localhost:9092',
  value_serializer=lambda v: json.dumps(v).encode('utf-8')
)

for i in range(5):
  message = {'id': i, 'data': f'Event {i}'}
  producer.send('test-topic', value=message)
  print(f'Sent: {message}')
  time.sleep(1)

producer.close()
</CopyBlock>

### ì½œë°± í•¨ìˆ˜ ì‚¬ìš©

ì „ì†¡ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.

<CopyBlock language="python" title="ì½œë°± í•¨ìˆ˜">
def on_send_success(record_metadata):
  print(f'Topic: {record_metadata.topic}')
  print(f'Partition: {record_metadata.partition}')
  print(f'Offset: {record_metadata.offset}')

def on_send_error(exc):
  print(f'Error: {exc}')

producer.send('test-topic', value=message).add_callbacks(
  on_success=on_send_success,
  on_error=on_send_error
)
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/kafka/step1-producer-ko.png"
  alt="í”„ë¡œë“€ì„œ"
  caption="Python í”„ë¡œë“€ì„œë¥¼ ì‘ì„±í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤"
  priority={true}
/>

<Callout type="success">
âœ… **ì™„ë£Œ!** í”„ë¡œë“€ì„œê°€ ë©”ì‹œì§€ë¥¼ ë°œí–‰í–ˆìŠµë‹ˆë‹¤.
</Callout>

<Checkpoint>
ë©”ì‹œì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ë°œí–‰ë˜ì—ˆë‚˜ìš”?
</Checkpoint>

</Step>

---

<Step number={2} title="Python ì»¨ìŠˆë¨¸ ì‘ì„±">

### ê¸°ë³¸ ì»¨ìŠˆë¨¸

ë©”ì‹œì§€ë¥¼ êµ¬ë…í•˜ëŠ” ì»¨ìŠˆë¨¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

<CopyBlock language="python" title="Python ì»¨ìŠˆë¨¸">
from kafka import KafkaConsumer
import json

consumer = KafkaConsumer(
  'test-topic',
  bootstrap_servers='localhost:9092',
  auto_offset_reset='earliest',
  value_deserializer=lambda m: json.loads(m.decode('utf-8')),
  group_id='my-group'
)

print('Waiting for messages...')
for message in consumer:
  print(f'Received: {message.value}')
  print(f'Partition: {message.partition}')
  print(f'Offset: {message.offset}')
</CopyBlock>

### ì»¨ìŠˆë¨¸ ê·¸ë£¹

ì—¬ëŸ¬ ì»¨ìŠˆë¨¸ê°€ ë©”ì‹œì§€ë¥¼ ë¶„ë‹´í•©ë‹ˆë‹¤.

<CopyBlock language="python" title="ì»¨ìŠˆë¨¸ ê·¸ë£¹">
consumer = KafkaConsumer(
  'test-topic',
  bootstrap_servers='localhost:9092',
  group_id='my-consumer-group',
  auto_offset_reset='earliest'
)
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/kafka/step2-consumer-ko.png"
  alt="ì»¨ìŠˆë¨¸"
  caption="Python ì»¨ìŠˆë¨¸ë¥¼ ì‘ì„±í•˜ì—¬ ë©”ì‹œì§€ë¥¼ êµ¬ë…í•©ë‹ˆë‹¤"
/>

<Callout type="tip">
ğŸ’¡ **íŒ**: `auto_offset_reset='earliest'`ëŠ” ì²˜ìŒë¶€í„° ë©”ì‹œì§€ë¥¼ ë°›ìŠµë‹ˆë‹¤. `'latest'`ëŠ” ìƒˆ ë©”ì‹œì§€ë§Œ ë°›ìŠµë‹ˆë‹¤.
</Callout>

<Checkpoint>
ì»¨ìŠˆë¨¸ê°€ ë©”ì‹œì§€ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë°›ì•˜ë‚˜ìš”?
</Checkpoint>

</Step>

---

<Step number={3} title="Node.js í”„ë¡œë“€ì„œ">

### Node.js í”„ë¡œë“€ì„œ ì‘ì„±

<CopyBlock language="javascript" title="Node.js í”„ë¡œë“€ì„œ">
const { Kafka } = require('kafkajs');

const kafka = new Kafka({
  clientId: 'producer-app',
  brokers: ['localhost:9092']
});

const producer = kafka.producer();

async function sendMessages() {
  await producer.connect();

  for (let i = 0; i < 5; i++) {
    await producer.send({
      topic: 'test-topic',
      messages: [
        {
          value: JSON.stringify({
            id: i,
            data: `Event ${i}`,
            timestamp: new Date()
          })
        }
      ]
    });
    console.log(`Sent message ${i}`);
  }

  await producer.disconnect();
}

sendMessages().catch(console.error);
</CopyBlock>

<DevTip>
ğŸ”§ **ê°œë°œíŒ**: `kafkajs`ëŠ” ìë™ìœ¼ë¡œ JSON ì§ë ¬í™”ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìˆ˜ë™ìœ¼ë¡œ `JSON.stringify`ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
</DevTip>

<Checkpoint>
Node.js í”„ë¡œë“€ì„œê°€ ì‘ë™í–ˆë‚˜ìš”?
</Checkpoint>

</Step>

---

<Step number={4} title="Node.js ì»¨ìŠˆë¨¸">

### Node.js ì»¨ìŠˆë¨¸ ì‘ì„±

<CopyBlock language="javascript" title="Node.js ì»¨ìŠˆë¨¸">
const { Kafka } = require('kafkajs');

const kafka = new Kafka({
  clientId: 'consumer-app',
  brokers: ['localhost:9092']
});

const consumer = kafka.consumer({ groupId: 'my-group' });

async function consumeMessages() {
  await consumer.connect();
  await consumer.subscribe({ topic: 'test-topic', fromBeginning: true });

  await consumer.run({
    eachMessage: async ({ topic, partition, message }) => {
      console.log(`Topic: ${topic}`);
      console.log(`Partition: ${partition}`);
      console.log(`Message: ${message.value.toString()}`);
    }
  });
}

consumeMessages().catch(console.error);
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/kafka/step4-nodejs-consumer-ko.png"
  alt="Node.js ì»¨ìŠˆë¨¸"
  caption="Node.jsë¡œ ë©”ì‹œì§€ë¥¼ êµ¬ë…í•©ë‹ˆë‹¤"
/>

<Callout type="success">
âœ… **ì™„ë£Œ!** Node.js ì»¨ìŠˆë¨¸ê°€ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ê³  ìˆìŠµë‹ˆë‹¤.
</Callout>

<Checkpoint>
Node.js ì»¨ìŠˆë¨¸ê°€ ë©”ì‹œì§€ë¥¼ ë°›ì•˜ë‚˜ìš”?
</Checkpoint>

</Step>

---

<Step number={5} title="ê³ ê¸‰ ê¸°ëŠ¥">

### íŠ¸ëœì­ì…˜

ì—¬ëŸ¬ ë©”ì‹œì§€ë¥¼ ì›ìì ìœ¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.

<CopyBlock language="python" title="íŠ¸ëœì­ì…˜">
from kafka.errors import KafkaError

try:
  result = producer.send('test-topic', value=message)
  metadata = result.get(timeout=10)
except KafkaError as e:
  print(f'Send failed: {e}')
</CopyBlock>

### ë°°ì¹˜ ì²˜ë¦¬

ì—¬ëŸ¬ ë©”ì‹œì§€ë¥¼ í•œ ë²ˆì— ë°œí–‰í•©ë‹ˆë‹¤.

<CopyBlock language="python" title="ë°°ì¹˜ ë°œí–‰">
messages = [
  {'id': i, 'data': f'Event {i}'}
  for i in range(100)
]

for msg in messages:
  producer.send('test-topic', value=msg)

producer.flush()
</CopyBlock>

<CopyBlock language="javascript" title="Node.js ë°°ì¹˜">
const messages = Array.from({length: 100}, (_, i) => ({
  value: JSON.stringify({id: i, data: `Event ${i}`})
}));

await producer.send({
  topic: 'test-topic',
  messages: messages
});
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/kafka/step5-advanced-ko.png"
  alt="ê³ ê¸‰ ê¸°ëŠ¥"
  caption="íŠ¸ëœì­ì…˜ê³¼ ë°°ì¹˜ ì²˜ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤"
/>

<DevTip>
ğŸ”§ **ê°œë°œíŒ**: `flush()` ë©”ì„œë“œë¡œ ëª¨ë“  ë©”ì‹œì§€ê°€ ì „ì†¡ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</DevTip>

</Step>

---

## ë‹¤ìŒ ë‹¨ê³„

- [Kafka ê³µì‹ ë¬¸ì„œ](https://kafka.apache.org/documentation/)
- [ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•](https://kafka.apache.org/documentation/#quickstart)
- [ëª¨ë‹ˆí„°ë§](https://kafka.apache.org/documentation/#monitoring)

## ì¼ë°˜ì ì¸ íŒ¨í„´

### ìš”ì²­-ì‘ë‹µ íŒ¨í„´

<CopyBlock language="python" title="ìš”ì²­-ì‘ë‹µ">
request_topic = 'requests'
response_topic = 'responses'

producer.send(request_topic, value={'request_id': 1, 'data': 'hello'})
</CopyBlock>

### ì´ë²¤íŠ¸ ë¡œê·¸

ëª¨ë“  ë³€ê²½ ì‚¬í•­ì„ ê¸°ë¡í•©ë‹ˆë‹¤.

<CopyBlock language="python" title="ì´ë²¤íŠ¸ ë¡œê·¸">
event_log = {
  'event_type': 'user_created',
  'user_id': 123,
  'timestamp': datetime.now().isoformat()
}
producer.send('events', value=event_log)
</CopyBlock>

## ëª¨ë‹ˆí„°ë§

### ì˜¤í”„ì…‹ í™•ì¸

<CopyBlock language="bash" title="ì˜¤í”„ì…‹ í™•ì¸">
docker-compose exec kafka kafka-consumer-groups \
  --bootstrap-server localhost:9092 \
  --group my-group \
  --describe
</CopyBlock>

---

## ë¬¸ì œ í•´ê²°

### ë©”ì‹œì§€ë¥¼ ë°›ì§€ ëª»í•¨

1. í† í”½ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
2. ì»¨ìŠˆë¨¸ ê·¸ë£¹ì´ ë§ëŠ”ì§€ í™•ì¸
3. `auto_offset_reset` ì„¤ì • í™•ì¸

### ëŠë¦° ì²˜ë¦¬

1. íŒŒí‹°ì…˜ ìˆ˜ë¥¼ ì¦ê°€
2. ì»¨ìŠˆë¨¸ ìˆ˜ë¥¼ ì¦ê°€
3. ë°°ì¹˜ ì²˜ë¦¬ í¬ê¸° ì¡°ì •
