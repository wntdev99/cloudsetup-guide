# Fly.io에 애플리케이션 배포하기

이제 Fly.io CLI가 설정되었으니 **실제 애플리케이션을 배포**할 차례입니다. Node.js, Python, Go, Ruby 등 어떤 언어로 작성한 앱도 배포할 수 있습니다. 30분 안에 애플리케이션을 전 세계에 배포할 수 있습니다.

<FreeTierInfo
  service="Fly.io 애플리케이션 배포"
  limit="3개 공유 CPU VM, 월 3GB 저장소"
  period="영구"
  status="generous"
/>

## 시작하기 전에

<PrerequisiteCheck items={[
  { text: "Fly.io 계정 및 CLI 설정 완료", required: true },
  { text: "배포할 애플리케이션 (Node.js, Python, Go, Ruby 등)", required: true },
  { text: "Git 설치 (선택사항)", required: false }
]} />

<Callout type="info">
🚀 **목표**: 애플리케이션을 Fly.io에 배포하고 전 세계 사용자에게 서빙합니다. Fly.io가 자동으로 Docker 이미지를 빌드하고 배포합니다.
</Callout>

---

<Step number={1} title="애플리케이션 준비 및 fly.toml 생성">

**앱 디렉토리 생성:**

<CopyBlock
  code="mkdir my-app && cd my-app"
  language="bash"
/>

**Fly.io 앱 초기화:**

<CopyBlock
  code="flyctl launch"
  language="bash"
  />

명령 프롬프트에서:

1. **앱 이름** 입력 (예: my-awesome-app).
2. **지역** 선택 (기본값: SFO).
3. **데이터베이스 추가?** - 필요시 선택.
4. **원하는대로** 또는 **Y** 입력.

이 명령은 **fly.toml** 파일을 생성합니다 - 배포 설정 파일입니다.

**fly.toml 파일 내용:**

<CopyBlock
  code="app = 'my-awesome-app'
primary_region = 'sfo'

[build]
image = 'my-awesome-app:latest'

[[services]]
internal_port = 3000
protocol = 'tcp'
auto_stop_machines = true
auto_start_machines = true"
  language="toml"
/>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/flyio/step1-launch-ko.png"
  alt="Fly.io 앱 초기화"
  caption="flyctl launch로 Fly.io 앱 초기화"
  priority={true}
/>

<Callout type="tip">
💡 **팁**: 포트 번호는 앱이 사용하는 포트로 변경하세요 (Node.js는 보통 3000, Python은 5000).
</Callout>

</Step>

---

<Step number={2} title="로컬에서 애플리케이션 테스트">

배포 전에 로컬에서 테스트합니다.

**Node.js 예제:**

<CopyBlock
  code="npm install && npm start"
  language="bash"
/>

**Python 예제:**

<CopyBlock
  code="pip install -r requirements.txt && python app.py"
  language="bash"
/>

**Go 예제:**

<CopyBlock
  code="go run main.go"
  language="bash"
/>

http://localhost:3000 (또는 해당 포트)에서 앱이 실행되는지 확인합니다.

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/flyio/step2-local-test-ko.png"
  alt="로컬 애플리케이션 테스트"
  caption="localhost에서 애플리케이션 테스트"
/>

<Callout type="warning">
⚠️ **중요**: 로컬에서 정상 작동하지 않으면 배포 후에도 문제가 생깁니다.
</Callout>

</Step>

---

<Step number={3} title="Fly.io에 애플리케이션 배포">

이제 애플리케이션을 배포합니다.

<CopyBlock
  code="flyctl deploy"
  language="bash"
/>

배포 과정:

1. **Dockerfile 생성** - flyctl이 자동으로 생성 (선택적).
2. **이미지 빌드** - Docker 이미지 빌드.
3. **레지스트리에 푸시** - Fly.io 레지스트리에 업로드.
4. **머신 생성** - VM 인스턴스 생성.
5. **배포** - 애플리케이션 시작.

배포가 완료되면:

<CopyBlock
  code="Visit your newly deployed app at https://my-awesome-app.fly.dev"
  language="bash"
/>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/flyio/step3-deploy-ko.png"
  alt="애플리케이션 배포"
  caption="flyctl deploy로 애플리케이션 배포"
/>

<Callout type="success">
✅ **축하합니다!** 애플리케이션이 배포되었습니다!
</Callout>

</Step>

---

<Step number={4} title="배포된 앱 관리 및 모니터링">

배포 후 앱을 관리합니다.

**로그 확인:**

<CopyBlock
  code="flyctl logs"
  language="bash"
/>

**앱 상태 확인:**

<CopyBlock
  code="flyctl status"
  language="bash"
/>

**환경 변수 설정:**

<CopyBlock
  code="flyctl secrets set DATABASE_URL=postgresql://..."
  language="bash"
/>

또는 여러 환경 변수를 한번에:

<CopyBlock
  code="flyctl secrets set API_KEY=xyz DATABASE_URL=postgresql://..."
  language="bash"
/>

**앱 스케일 조정:**

<CopyBlock
  code="flyctl scale vm shared-cpu-1x 3"
  language="bash"
/>

이 명령은 3개의 VM 인스턴스로 확장합니다 (무료 티어에서는 합계 3개 이내).

**도메인 연결:**

<CopyBlock
  code="flyctl certs add example.com"
  language="bash"
/>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/flyio/step4-manage-ko.png"
  alt="배포된 앱 관리"
  caption="flyctl로 배포된 앱 관리"
/>

<Callout type="tip">
💡 **팁**: `flyctl status`로 실시간 상태를 확인하세요.
</Callout>

</Step>

---

<Step number={5} title="업데이트 및 재배포">

코드를 변경한 후 다시 배포합니다.

**코드 변경:**

앱의 코드를 수정합니다.

**재배포:**

<CopyBlock
  code="flyctl deploy"
  language="bash"
/>

또는 특정 Dockerfile을 사용:

<CopyBlock
  code="flyctl deploy --dockerfile ./Dockerfile"
  language="bash"
/>

**배포 이력 확인:**

<CopyBlock
  code="flyctl releases"
  language="bash"
/>

**이전 버전으로 롤백:**

<CopyBlock
  code="flyctl releases rollback"
  language="bash"
/>

<Checkpoint
  title="배포 완료 확인"
  items={[
    "flyctl launch를 실행했나요?",
    "로컬에서 앱을 테스트했나요?",
    "flyctl deploy로 배포했나요?",
    "배포된 URL에 접속했나요?",
    "로그를 확인했나요?"
  ]}
/>

<Callout type="success">
✅ **완료!** 애플리케이션이 Fly.io에 배포되고 전 세계 사용자가 접속할 수 있습니다.
</Callout>

</Step>

---

## 다음 단계

Fly.io 배포를 완료했으니:

1. **[도메인 설정](https://fly.io/docs/networking/custom-domain/)** - 커스텀 도메인 연결
2. **[자동 배포](https://fly.io/docs/reference/github-actions/)** - GitHub Actions로 자동 배포
3. **[데이터베이스 추가](https://fly.io/docs/postgres/)** - PostgreSQL 추가

---

## 개발자 팁

<DevTip>
**flyctl 주요 배포 명령어:**

```
flyctl deploy               # 배포
flyctl deploy --strategy=rolling  # 순차 배포
flyctl deploy --detach              # 백그라운드 배포
flyctl deploy --build-only          # 빌드만 수행
```

특히 --strategy=rolling로 무중단 배포가 가능합니다.
</DevTip>

---

## 자주 묻는 질문

<Callout type="info">
**Q. 배포가 실패합니다**

A. 로그를 확인하세요: `flyctl logs`. 일반적인 원인:
- 포트 설정 오류
- 환경 변수 누락
- 의존성 미설치
</Callout>

<Callout type="info">
**Q. 배포 후 앱이 실행되지 않습니다**

A. `flyctl status`로 상태를 확인하고, `flyctl logs`로 오류를 찾습니다.
</Callout>

<Callout type="info">
**Q. 환경 변수를 설정하려면?**

A. `flyctl secrets set KEY=VALUE`로 설정합니다. 변경 후 재배포가 필요합니다.
</Callout>

---

## 문제 해결

### "Failed to connect to builder" 오류

- 인터넷 연결 확인
- Fly.io 상태 페이지 확인
- 다시 시도: `flyctl deploy --force`

### 배포 후 502 오류

- `flyctl logs` 확인
- 포트 설정 확인 (fly.toml)
- 환경 변수 설정 확인

### 메모리 부족 오류

- 머신 사양 업그레이드: `flyctl scale vm shared-cpu-2x`
- 또는 메모리 누수 확인

---

**축하합니다!** 애플리케이션이 Fly.io에 성공적으로 배포되었습니다. 이제 전 세계 사용자가 당신의 앱에 접속할 수 있습니다! 🚀
