# RabbitMQ ë©”ì‹œì§€ í - ë©”ì‹œì§€ ë°œí–‰ ë° ì²˜ë¦¬

RabbitMQì—ì„œ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ê³  ì²˜ë¦¬í•©ë‹ˆë‹¤. íë¥¼ ìƒì„±í•˜ê³  ë°œí–‰ì(Publisher)ì™€ ì†Œë¹„ì(Consumer)ë¥¼ êµ¬í˜„í•˜ì—¬ ë¹„ë™ê¸° ë©”ì‹œì§€ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

<FreeTierInfo
  service="RabbitMQ"
  limit="ì˜¤í”ˆì†ŒìŠ¤, ë¬´ë£Œ ìì²´ í˜¸ìŠ¤íŒ…"
  period="one-time"
  status="free"
/>

## ì‹œì‘í•˜ê¸° ì „ì—

<PrerequisiteCheck items={[
  { text: "RabbitMQ ì„¤ì¹˜ë¨", required: true },
  { text: "pika ë˜ëŠ” amqplib", required: true },
  { text: "Python ë˜ëŠ” Node.js", required: true },
  { text: "í„°ë¯¸ë„", required: true }
]} />

<Callout type="info">
ğŸ“¬ **ë©”ì‹œì§€ íì˜ ì¥ì ** ë°œí–‰ìì™€ ì†Œë¹„ìê°€ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì†Œë¹„ìê°€ ë‹¤ìš´ë˜ë©´ ë©”ì‹œì§€ëŠ” íì— ì €ì¥ë˜ê³ , ì†Œë¹„ìê°€ ë³µêµ¬ë˜ë©´ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
</Callout>

---

<Step number={1} title="Python ë°œí–‰ì ì‘ì„±">

### ê¸°ë³¸ ë©”ì‹œì§€ ë°œí–‰

Pythonì—ì„œ ë©”ì‹œì§€ë¥¼ RabbitMQì— ë°œí–‰í•©ë‹ˆë‹¤.

<CopyBlock language="python" title="Python ë°œí–‰ì">
import pika
import json

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(queue='hello', durable=True)

message = {'text': 'Hello RabbitMQ!', 'id': 1}

channel.basic_publish(
  exchange='',
  routing_key='hello',
  body=json.dumps(message),
  properties=pika.BasicProperties(
    delivery_mode=pika.DeliveryMode.Persistent
  )
)

print(f'Message sent: {message}')
connection.close()
</CopyBlock>

### ì—¬ëŸ¬ ë©”ì‹œì§€ ë°œí–‰

<CopyBlock language="python" title="ë°°ì¹˜ ë°œí–‰">
for i in range(10):
  message = {'id': i, 'data': f'Message {i}'}
  channel.basic_publish(
    exchange='',
    routing_key='hello',
    body=json.dumps(message)
  )
  print(f'Sent message {i}')
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/rabbitmq/step1-publisher-ko.png"
  alt="ë°œí–‰ì"
  caption="Python ë°œí–‰ìë¥¼ ì‘ì„±í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤"
  priority={true}
/>

<Callout type="success">
âœ… **ì™„ë£Œ!** ë©”ì‹œì§€ê°€ íì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.
</Callout>

<Checkpoint>
ë©”ì‹œì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ë°œí–‰ë˜ì—ˆë‚˜ìš”?
</Checkpoint>

</Step>

---

<Step number={2} title="Python ì†Œë¹„ì ì‘ì„±">

### ê¸°ë³¸ ë©”ì‹œì§€ ì²˜ë¦¬

<CopyBlock language="python" title="Python ì†Œë¹„ì">
import pika
import json

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(queue='hello', durable=True)

def callback(ch, method, properties, body):
  message = json.loads(body)
  print(f'Received: {message}')
  ch.basic_ack(delivery_tag=method.delivery_tag)

channel.basic_consume(queue='hello', on_message_callback=callback)

print('Waiting for messages...')
try:
  channel.start_consuming()
except KeyboardInterrupt:
  channel.stop_consuming()
  connection.close()
</CopyBlock>

### ì—¬ëŸ¬ ì†Œë¹„ì ì²˜ë¦¬

<CopyBlock language="python" title="ê³µì •í•œ ë¶„ë°°">
channel.basic_qos(prefetch_count=1)
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/rabbitmq/step2-consumer-ko.png"
  alt="ì†Œë¹„ì"
  caption="Python ì†Œë¹„ìë¥¼ ì‘ì„±í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤"
/>

<Callout type="tip">
ğŸ’¡ **íŒ**: `basic_ack`ëŠ” ë©”ì‹œì§€ ì²˜ë¦¬ ì™„ë£Œë¥¼ RabbitMQì— ì•Œë¦½ë‹ˆë‹¤. ì´ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ë©”ì‹œì§€ê°€ ë‹¤ì‹œ íë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.
</Callout>

<Checkpoint>
ì†Œë¹„ìê°€ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í–ˆë‚˜ìš”?
</Checkpoint>

</Step>

---

<Step number={3} title="Node.js ë°œí–‰ì">

### Node.jsì—ì„œ ë©”ì‹œì§€ ë°œí–‰

<CopyBlock language="javascript" title="Node.js ë°œí–‰ì">
const amqp = require('amqplib');

async function publishMessage() {
  const connection = await amqp.connect('amqp://localhost');
  const channel = await connection.createChannel();

  const queue = 'hello';
  const message = JSON.stringify({
    text: 'Hello RabbitMQ!',
    id: 1,
    timestamp: new Date()
  });

  await channel.assertQueue(queue, { durable: true });
  channel.sendToQueue(queue, Buffer.from(message), { persistent: true });

  console.log('Message sent:', message);

  setTimeout(() => {
    channel.close();
    connection.close();
  }, 500);
}

publishMessage().catch(console.error);
</CopyBlock>

<DevTip>
ğŸ”§ **ê°œë°œíŒ**: `persistent: true`ëŠ” ë©”ì‹œì§€ë¥¼ ë””ìŠ¤í¬ì— ì €ì¥í•˜ì—¬ RabbitMQ ì¬ì‹œì‘ í›„ì—ë„ ë³´ì¡´ë©ë‹ˆë‹¤.
</DevTip>

<Checkpoint>
Node.js ë°œí–‰ìê°€ ì‘ë™í–ˆë‚˜ìš”?
</Checkpoint>

</Step>

---

<Step number={4} title="Node.js ì†Œë¹„ì">

### Node.jsì—ì„œ ë©”ì‹œì§€ ì²˜ë¦¬

<CopyBlock language="javascript" title="Node.js ì†Œë¹„ì">
const amqp = require('amqplib');

async function consumeMessage() {
  const connection = await amqp.connect('amqp://localhost');
  const channel = await connection.createChannel();

  const queue = 'hello';
  await channel.assertQueue(queue, { durable: true });

  console.log('Waiting for messages...');

  channel.consume(queue, (message) => {
    if (message) {
      console.log('Received:', message.content.toString());
      channel.ack(message);
    }
  });
}

consumeMessage().catch(console.error);
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/rabbitmq/step4-nodejs-consumer-ko.png"
  alt="Node.js ì†Œë¹„ì"
  caption="Node.js ì†Œë¹„ìë¥¼ ì‘ì„±í•©ë‹ˆë‹¤"
/>

<Callout type="success">
âœ… **ì™„ë£Œ!** Node.js ì†Œë¹„ìê°€ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
</Callout>

<Checkpoint>
Node.js ì†Œë¹„ìê°€ ë©”ì‹œì§€ë¥¼ ë°›ì•˜ë‚˜ìš”?
</Checkpoint>

</Step>

---

<Step number={5} title="ê³ ê¸‰ íŒ¨í„´">

### Exchangeì™€ Binding

<CopyBlock language="python" title="Fanout Exchange">
channel.exchange_declare(exchange='logs', exchange_type='fanout')

channel.queue_declare(queue='logs_queue1')
channel.queue_declare(queue='logs_queue2')

channel.queue_bind(exchange='logs', queue='logs_queue1')
channel.queue_bind(exchange='logs', queue='logs_queue2')

channel.basic_publish(exchange='logs', routing_key='', body=b'Log message')
</CopyBlock>

### Topic Exchange

<CopyBlock language="python" title="Topic Exchange">
channel.exchange_declare(exchange='events', exchange_type='topic')

channel.queue_declare(queue='user_events')
channel.queue_declare(queue='order_events')

channel.queue_bind(exchange='events', queue='user_events', routing_key='user.*')
channel.queue_bind(exchange='events', queue='order_events', routing_key='order.*')

channel.basic_publish(exchange='events', routing_key='user.created', body=b'New user')
channel.basic_publish(exchange='events', routing_key='order.placed', body=b'Order placed')
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/rabbitmq/step5-advanced-ko.png"
  alt="ê³ ê¸‰ íŒ¨í„´"
  caption="Exchangeì™€ Bindingì„ ì‚¬ìš©í•œ ë©”ì‹œì§€ ë¼ìš°íŒ…"
/>

<DevTip>
ğŸ”§ **ê°œë°œíŒ**: Topic exchangeëŠ” ì™€ì¼ë“œì¹´ë“œ(`*` í•œ ë‹¨ì–´, `#` ì—¬ëŸ¬ ë‹¨ì–´)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
</DevTip>

</Step>

---

## ë‹¤ìŒ ë‹¨ê³„

- [RabbitMQ ê³µì‹ ë¬¸ì„œ](https://www.rabbitmq.com/documentation.html)
- [RPC íŒ¨í„´](https://www.rabbitmq.com/tutorials/tutorial-six-python.html)
- [ì„±ëŠ¥ ìµœì í™”](https://www.rabbitmq.com/blog/2021/07/07/high-performance-publishing/)

## Exchange íƒ€ì…

### Direct

ë¼ìš°íŒ… í‚¤ê°€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” íì—ë§Œ ì „ë‹¬í•©ë‹ˆë‹¤.

<CopyBlock language="text" title="Direct ì˜ˆì‹œ">
channel.queue_bind(exchange='tasks', routing_key='task.urgent')
</CopyBlock>

### Topic

ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´ìœ¼ë¡œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.

<CopyBlock language="text" title="Topic ì˜ˆì‹œ">
routing_key='logs.error.*'
routing_key='*.critical'
</CopyBlock>

### Fanout

ëª¨ë“  ë°”ì¸ë”©ëœ íë¡œ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•©ë‹ˆë‹¤.

<CopyBlock language="text" title="Fanout ì˜ˆì‹œ">
channel.basic_publish(exchange='broadcast', routing_key='')
</CopyBlock>

## ëª¨ë‹ˆí„°ë§

### ê´€ë¦¬ ì½˜ì†”ì—ì„œ í™•ì¸

RabbitMQ ê´€ë¦¬ ì½˜ì†”(http://localhost:15672)ì—ì„œ:

1. **Queues** íƒ­ì—ì„œ í ìƒíƒœ í™•ì¸
2. **Connections** íƒ­ì—ì„œ í™œì„± ì—°ê²° í™•ì¸
3. **Channels** íƒ­ì—ì„œ ì±„ë„ ì •ë³´ í™•ì¸

---

## ë¬¸ì œ í•´ê²°

### ë©”ì‹œì§€ë¥¼ ë°›ì§€ ëª»í•¨

1. íê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
2. ì†Œë¹„ìê°€ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
3. ê´€ë¦¬ ì½˜ì†”ì—ì„œ íì˜ ë©”ì‹œì§€ ê°œìˆ˜ í™•ì¸

### ë©”ì‹œì§€ ì†ì‹¤

1. `durable=True`ë¡œ í ì„¤ì •
2. `persistent=True`ë¡œ ë©”ì‹œì§€ ì„¤ì •
3. `basic_ack`ë¡œ í™•ì¸ì‘ë‹µ ì²˜ë¦¬

### ì„±ëŠ¥ ì €í•˜

1. `prefetch_count` ì¡°ì •
2. ì†Œë¹„ì ìˆ˜ ì¦ê°€
3. ë©”ì‹œì§€ ë°°ì¹˜ ì²˜ë¦¬
