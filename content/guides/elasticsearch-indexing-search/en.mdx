# Index and Search Data in Elasticsearch

Now you'll learn how to **store data and perform full-text searches** in Elasticsearch. Use practical examples to index documents and write search queries.

<FreeTierInfo
  service="Elasticsearch"
  limit="Unlimited indexing and searching"
  period="unlimited"
  status="generous"
/>

## Before You Start

<PrerequisiteCheck items={[
  { text: "Elasticsearch installed", required: true },
  { text: "Elasticsearch server running", required: true },
  { text: "curl or API client (Postman, Thunder Client)", required: true },
  { text: "Basic JSON syntax understanding", required: false }
]} />

<Callout type="info">
ðŸ“š **What is Indexing?** Indexing is the process of storing documents in a database. Elasticsearch uses an inverted index to store and quickly search JSON documents.
</Callout>

---

<Step number={1} title="Create an Index">

An index is like a **database** in Elasticsearch. It's where you store documents.

### Basic Index Creation

<CopyBlock language="bash" title="Create index">
curl -X PUT http://localhost:9200/products
</CopyBlock>

Response:
```json
{
  "acknowledged": true,
  "shards_acknowledged": true,
  "index": "products"
}
```

### Create Index with Mappings

Create with detailed field definitions:

<CopyBlock language="bash" title="Create index with mappings">
curl -X PUT http://localhost:9200/articles -H "Content-Type: application/json" -d '{"mappings":{"properties":{"title":{"type":"text"},"content":{"type":"text"},"author":{"type":"keyword"},"published_date":{"type":"date"},"tags":{"type":"keyword"}}}}'
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/elasticsearch/step1-create-index-en.png"
  alt="Create index"
  caption="Create Elasticsearch index with curl"
  priority={true}
/>

<Callout type="tip">
ðŸ’¡ **Field Types**: `text` is for full-text search (word analysis), `keyword` is for exact matches.
</Callout>

<Checkpoint>
Do you see "acknowledged": true in the response?
</Checkpoint>

</Step>

---

<Step number={2} title="Index Documents">

Add documents to your index.

### Add a Single Document

<CopyBlock language="bash" title="Add document">
curl -X POST http://localhost:9200/products/_doc -H "Content-Type: application/json" -d '{"name":"Laptop","price":1200000,"category":"Electronics","in_stock":true,"description":"High-performance laptop, 8-core processor, 16GB RAM"}'
</CopyBlock>

Response shows the created ID:
```json
{
  "_index": "products",
  "_type": "_doc",
  "_id": "abc123",
  "_version": 1,
  "result": "created"
}
```

### Bulk Index Multiple Documents

Index many documents at once for faster ingestion:

<CopyBlock language="bash" title="Bulk indexing">
curl -X POST http://localhost:9200/products/_bulk -H "Content-Type: application/json" -d '{"index":{}}\n{"name":"Mouse","price":50000,"category":"Accessories"}\n{"index":{}}\n{"name":"Keyboard","price":150000,"category":"Accessories"}\n{"index":{}}\n{"name":"Monitor","price":350000,"category":"Electronics"}'
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/elasticsearch/step2-index-documents-en.png"
  alt="Index documents"
  caption="Add JSON documents to Elasticsearch"
/>

<DevTip>
Bulk indexing is much faster for large datasets. It can be hundreds of times faster than indexing one document at a time.
</DevTip>

<Checkpoint>
Did documents get added successfully? Did you get an _id in the response?
</Checkpoint>

</Step>

---

<Step number={3} title="Write Search Queries">

### Match Query (Full-text Search)

Search for documents containing specific words:

<CopyBlock language="bash" title="Match query">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"query":{"match":{"description":"processor"}}}'
</CopyBlock>

### Term Query (Exact Match)

Search for exact values:

<CopyBlock language="bash" title="Term query">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"query":{"term":{"category":"Accessories"}}}'
</CopyBlock>

### Range Query

Search for documents within a price range:

<CopyBlock language="bash" title="Range query">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"query":{"range":{"price":{"gte":100000,"lte":500000}}}}'
</CopyBlock>

### Bool Query (Complex Conditions)

Combine multiple conditions:

<CopyBlock language="bash" title="Bool query">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"query":{"bool":{"must":[{"match":{"category":"Electronics"}}],"filter":[{"range":{"price":{"gte":1000000}}}]}}}'
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/elasticsearch/step3-search-queries-en.png"
  alt="Search queries"
  caption="Search data with various query types"
/>

<Checkpoint>
Do you see search results? Are documents in the hits array?
</Checkpoint>

</Step>

---

<Step number={4} title="Sort and Filter Results">

### Sort Results

Search with results sorted by price:

<CopyBlock language="bash" title="Sort by price">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"query":{"match_all":{}},"sort":[{"price":{"order":"desc"}}]}'
</CopyBlock>

### Pagination

Use from and size for paginated results:

<CopyBlock language="bash" title="Pagination">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"query":{"match_all":{}},"from":0,"size":10}'
</CopyBlock>

### Select Specific Fields

Return only needed fields:

<CopyBlock language="bash" title="Select fields">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"query":{"match_all":{}},"_source":["name","price","category"]}'
</CopyBlock>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/elasticsearch/step4-sorting-en.png"
  alt="Sorting and filtering"
  caption="Optimize results with sorting, pagination, and field selection"
/>

</Step>

---

<Step number={5} title="Aggregations and Analytics">

### Count Documents by Category

<CopyBlock language="bash" title="Aggregation query">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"aggs":{"category_counts":{"terms":{"field":"category"}}}}'
</CopyBlock>

Response:
```json
{
  "aggregations": {
    "category_counts": {
      "buckets": [
        {
          "key": "Electronics",
          "doc_count": 2
        },
        {
          "key": "Accessories",
          "doc_count": 3
        }
      ]
    }
  }
}
```

### Calculate Average Price

<CopyBlock language="bash" title="Calculate average">
curl -X GET http://localhost:9200/products/_search -H "Content-Type: application/json" -d '{"aggs":{"avg_price":{"avg":{"field":"price"}}}}'
</CopyBlock>

<Callout type="success">
âœ… **Congratulations!** You can now index and search data in Elasticsearch.
</Callout>

<Screenshot
  src="https://res.cloudinary.com/demo/image/upload/v1/elasticsearch/step5-aggregations-en.png"
  alt="Aggregations"
  caption="Get statistical information about your data with aggregations"
/>

</Step>

---

## Practical Tips

### Check Index Information

<CopyBlock language="bash" title="Check mappings">
curl http://localhost:9200/products/_mapping
</CopyBlock>

### Delete an Index

<CopyBlock language="bash" title="Delete index">
curl -X DELETE http://localhost:9200/products
</CopyBlock>

### List All Indexes

<CopyBlock language="bash" title="List indexes">
curl http://localhost:9200/_cat/indices
</CopyBlock>

---

## Troubleshooting

### No Search Results

1. Check if documents exist:
   ```bash
   curl http://localhost:9200/products/_count
   ```

2. Verify mappings - check field types are correct

3. Check query syntax - validate JSON is valid

### Slow Performance

1. Optimize index settings
2. Exclude unnecessary fields
3. Use query caching
4. Adjust shard count
